{
    "sourceFile": "src/auth/AuthProvider.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1766404864015,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1766404864015,
            "name": "Commit-0",
            "content": "import React, { createContext, useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport authService from '../services/authService';\r\nimport { getLocalToken, setLocalToken } from '../hooks/useLocalStorage';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null); // {id, name, role, ...}\r\n  const [token, setToken] = useState(() => getLocalToken());\r\n  const [loading, setLoading] = useState(!!token);\r\n\r\n  useEffect(() => {\r\n    async function restore() {\r\n      if (!token) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      try {\r\n        const data = await authService.me(token); // call backend /me\r\n        setUser(data.user);\r\n      } catch (err) {\r\n        console.error('Failed to restore session', err);\r\n        setToken(null);\r\n        setUser(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    restore();\r\n  }, [token]);\r\n\r\n  const login = async (credentials) => {\r\n    const { token: newToken, user: u } = await authService.login(credentials);\r\n    setToken(newToken);\r\n    setLocalToken(newToken);\r\n    setUser(u);\r\n    return u;\r\n  };\r\n\r\n  const logout = async () => {\r\n    await authService.logout(token);\r\n    setToken(null);\r\n    setUser(null);\r\n    setLocalToken(null);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, token, login, logout, loading, setUser }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nAuthProvider.propTypes = { children: PropTypes.node };\r\nexport default AuthContext;"
        }
    ]
}